<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Part 2 | Body 1 ãƒ“ãƒ«ãƒ€ãƒ¼ï¼ˆç†ç”±â†’ãŸã¨ãˆã° ã‚¯ã‚¤ã‚º + TTSï¼‰</title>
<style>
  :root{ --bg:#f7f7fb; --card:#fff; --ink:#0f172a; --muted:#6b7280; --accent:#2563eb; --ring:#93c5fd; --ok:#16a34a; --bad:#dc2626; --radius:16px; }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Noto Sans JP",Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  .container{max-width:900px;margin:0 auto;padding:clamp(16px,3vw,28px)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:10px}
  h1{font-size:clamp(20px,4.6vw,28px);margin:0}
  .toolbar{display:flex;gap:8px}
  button{border:0;background:var(--accent);color:#fff;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;box-shadow:0 1px 0 rgba(0,0,0,.08)}
  button.secondary{background:#e5e7eb;color:#111827}
  button.ghost{background:transparent;color:var(--accent);padding:8px 10px}
  button.primary{background:var(--accent);color:#fff}
  button:focus{outline:2px solid var(--ring);outline-offset:2px}
  .badge{display:inline-flex;align-items:center;gap:6px;background:#e0e7ff;color:#3730a3;font-weight:700;padding:4px 10px;border-radius:999px;font-size:12px}
  .muted{color:var(--muted)} .hr{height:1px;background:#e5e7eb;margin:12px 0}
  .card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 8px 24px rgba(2,6,23,.06)}
  .row{display:grid;gap:10px}
  .topic{font-weight:800;font-size:20px}
  .steps{display:flex;gap:6px;flex-wrap:wrap;margin:4px 0 2px}
  .pill{background:#eef2ff;color:#1e293b;font-weight:700;padding:3px 10px;border-radius:999px;font-size:12px}
  .pill.active{background:var(--accent);color:#fff}
  .pill.done{background:#dcfce7;color:#065f46}
  .choice-wrap{display:flex;flex-wrap:wrap;gap:8px}
  .chip{padding:10px 12px;border:1px solid #e5e7eb;border-radius:999px;cursor:pointer;background:#fff;transition:transform .08s ease, background .15s ease, border-color .15s ease;color:var(--ink)}
  .chip:hover{transform:translateY(-1px)}
  .chip[disabled]{opacity:.55;cursor:not-allowed;transform:none}
  .chip.ok.selected{background:#dcfce7;border-color:#86efac}
  .chip.bad.flash{background:#fee2e2;border-color:#fecaca}
  .preview{background:#f1f5f9;border-radius:12px;padding:12px;font-size:15px}
  .tts{display:flex;align-items:center;gap:8px;margin-top:6px}
  .progress{height:6px;background:#e5e7eb;border-radius:999px;overflow:hidden}
  .bar{height:100%;width:0%;background:linear-gradient(90deg,#60a5fa,#2563eb);transition:width .25s ease}
  .footer{display:flex;gap:8px;justify-content:flex-end;align-items:center;flex-wrap:wrap;margin-top:10px}
  .result{font-weight:700}.result.ok{color:var(--ok)}.result.bad{color:var(--bad)}
  .copy-area{white-space:pre-wrap;background:#0b1020;color:#e2e8f0;padding:12px;border-radius:12px;font-size:14px}
  details{margin-top:4px} summary{cursor:pointer;color:var(--muted)}

  /* STEP1ã®ç­”ãˆè¦ç´„ï¼ˆSTEP2ãƒ˜ãƒƒãƒ€ã®ä¸‹ã«å‡ºã™ï¼‰ */
  .summary-line{display:none;align-items:center;gap:10px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:12px;padding:8px 10px}
  .summary-line .tag{background:#dcfce7;color:#065f46;padding:2px 8px;border-radius:999px;font-weight:700;font-size:12px}
  .hint{color:#166534;font-weight:700}
  @media (min-width:760px){ .chip{padding:12px 14px} }
  @media print{ header,.toolbar,.footer,.tts,details{display:none!important} body{background:#fff} .card{box-shadow:none;border:1px solid #e5e7eb} }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>ğŸŸ¨ Part 2ï½œBody 1 ãƒ“ãƒ«ãƒ€ãƒ¼ï¼ˆã‚¯ã‚¤ã‚ºï¼‰</h1>
    <div class="toolbar">
      <button id="btn-reset" class="ghost">â†º ãƒªã‚»ãƒƒãƒˆ</button>
      <button id="btn-print" class="ghost">ğŸ–¨ï¸ å°åˆ·</button>
    </div>
  </header>

  <div class="progress"><div id="bar" class="bar"></div></div>

  <div id="quiz" class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
      <div class="badge">Q<span id="qnum">1</span> / <span id="qtotal">3</span></div>
      <div class="muted">æ­£è§£æ•°ï¼š<b id="score">0</b></div>
    </div>

    <div class="hr"></div>

    <!-- STEPã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ -->
    <div class="steps">
      <span class="pill" id="pill-step1">STEP 1: ç†ç”±</span>
      <span class="pill" id="pill-step2">STEP 2: ãŸã¨ãˆã°</span>
      <span class="pill" id="pill-preview">ğŸ”Š Preview</span>
    </div>

    <div class="row" style="margin-top:6px">
      <div class="topic" id="topicText"></div>
    </div>

    <!-- STEP1 -->
    <div id="reasonBlock" class="row" style="margin-top:4px">
      <div style="font-weight:700">STEP 1ï½œç†ç”±ï¼ˆ1ã€œ5ï¼‰ã‚’é¸ã¼ã†</div>
      <div id="reasonArea" class="choice-wrap"></div>
      <div id="reasonMsg" class="muted">ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ</div>
    </div>

    <!-- STEP2 -->
    <div class="row" id="exampleBlock" style="margin-top:8px; display:none">
      <div style="font-weight:700">STEP 2ï½œãã®ç†ç”±ã«åˆã† ãŸã¨ãˆã° ã‚’é¸ã¼ã†</div>
      <div id="reasonSummary" class="summary-line">
        <span class="tag">âœ“ ç†ç”±</span>
        <span id="reasonPickedText"></span>
      </div>
      <div id="exampleArea" class="choice-wrap"></div>
      <div id="exampleMsg" class="muted">ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ</div>
    </div>

    <!-- Preview & TTS -->
    <div class="row" style="margin-top:10px">
      <div class="preview" id="preview"><b>Preview:</b><br>First, â€” because â€”.<br>For example, â€”.</div>
      <div class="tts">
        <button id="btn-tts" class="secondary">ğŸ”Š èª­ã‚€</button>
        <details><summary>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆé€Ÿåº¦ï¼‰</summary>
          <label class="muted">é€Ÿåº¦ <input id="rate" type="range" min="0.7" max="1.3" step="0.1" value="1"></label>
        </details>
        <small id="ttsNote" class="muted"></small>
      </div>
    </div>

    <div class="footer">
      <div id="result" class="muted">STEP 1 â†’ STEP 2 ã®é †ã«å®Œæˆã•ã›ã‚ˆã†</div>
      <button id="btn-randTopic" class="secondary">ğŸ² åˆ¥ãƒˆãƒ”ãƒƒã‚¯</button>
      <button id="btn-next" class="primary" disabled>æ¬¡ã¸ â†’</button>
    </div>
  </div>

  <div class="hr"></div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
      <div style="font-weight:700">ğŸ“œ ã¾ã¨ã‚ï¼ˆã‚³ãƒ”ãƒ¼ç”¨ï¼‰</div>
      <button id="btn-copy" class="secondary">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
    <div id="answers" class="copy-area" aria-live="polite"></div>
  </div>
</div>

<script>
  // ====== Config ======
  const CONFIG = { questionCount: 3, topicMode: 'auto', presetTopics: ['A','C','E'] };
  (function(){
    const sp = new URLSearchParams(location.search);
    const m = sp.get('topics');
    if(m){ CONFIG.topicMode = 'preset'; CONFIG.presetTopics = m.split(',').map(s=>s.trim().toUpperCase()).filter(Boolean); }
  })();

  // ====== Data ======
  const topics = [
    { key:'A', text:'Students should wear school uniforms.' },
    { key:'B', text:'Eating vegetables is important.' },
    { key:'C', text:'Going to bed early is a good habit.' },
    { key:'D', text:'Using tablets in class is helpful.' },
    { key:'E', text:'Eating breakfast is important.' },
  ];
  const reasons = [
    { key:'1', text:'it helps us focus.' },
    { key:'2', text:'it gives us more energy.' },
    { key:'3', text:'it saves time in the morning.' },
    { key:'4', text:'it keeps us healthy.' },
    { key:'5', text:'it speeds up research.' },
  ];

  /* ä¾‹æ–‡ï¼ˆA2ã€œB1 ã¸å°‘ã—ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼‰ */
  const examples = [
    { key:'i',  text:'I can stay focused in class.' },           // 1: focus
    { key:'ii', text:'I feel more awake in the morning.' },       // 2: energy
    { key:'iii',text:'We can get ready more quickly.' },          // 3: time
    { key:'iv', text:'I rarely catch colds.' },                   // 4: health
    { key:'v',  text:'We can look up information in seconds.' }   // 5: research
  ];

  // ç†ç”±â‡”ä¾‹ã®å¯¾å¿œ
  const exampleByReason = { '1':'i','2':'ii','3':'iii','4':'iv','5':'v' };
  // ãƒˆãƒ”ãƒƒã‚¯ã”ã¨ã®æ­£ç­”ç†ç”±
  const correctReasonsByTopic = { 'A':['1','3'], 'B':['4'], 'C':['2','1'], 'D':['5','1'], 'E':['2','4'] };

  /* å°å­¦ç”Ÿå‘ã‘ã®çŸ­ã„ãƒ’ãƒ³ãƒˆ */
  const reasonMeta = {
    '1': {tag:'ğŸ§ é›†ä¸­', hint:'æˆæ¥­ã«é›†ä¸­ã§ãã‚‹ï¼æ°—ãŒæ•£ã‚Šã«ãã„'},
    '2': {tag:'âš¡ å…ƒæ°—', hint:'æœã«å…ƒæ°—ãƒ»ç›®ãŒã•ã‚ã‚‹'},
    '3': {tag:'â± æœã®æ™‚é–“', hint:'æ”¯åº¦ãŒã¯ã‚„ã„ãƒ»æ™‚é–“ã®ç¯€ç´„'},
    '4': {tag:'ğŸ’ª å¥åº·', hint:'ç—…æ°—ã«ãªã‚Šã«ãã„ãƒ»ä½“ãŒå…ƒæ°—'},
    '5': {tag:'ğŸ” èª¿ã¹ã‚‹é€Ÿã•', hint:'è¨€è‘‰ã‚„æƒ…å ±ã‚’ã™ãèª¿ã¹ã‚‰ã‚Œã‚‹'}
  };
  const topicWhy = {
    'A':'åˆ¶æœã ã¨æ¯æœã®æœãˆã‚‰ã³ãŒã„ã‚‰ãšã€è¦‹ãŸç›®ã®å·®ã‚‚å°ã•ãã¦æ°—ãŒæ•£ã‚Šã«ãã„ã€‚',
    'B':'é‡èœã¯ä½“ã®èª¿å­ã‚’ã¨ã¨ã®ãˆã€ç—…æ°—ã‚’ã¸ã‚‰ã™åŠ©ã‘ã«ãªã‚‹ã€‚',
    'C':'æ—©ãå¯ã‚‹ã¨æ¬¡ã®æœã«å…ƒæ°—ã§ã€æˆæ¥­ã§ã‚‚é›†ä¸­ã—ã‚„ã™ã„ã€‚',
    'D':'ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãªã‚‰è¨€è‘‰ã‚„æƒ…å ±ã‚’ã™ãèª¿ã¹ã‚‰ã‚Œã¦ã€å­¦ç¿’ãŒé€²ã‚€ã€‚',
    'E':'æœã”ã¯ã‚“ã§ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒæ‰‹ã«å…¥ã‚Šã€ä½“ã‚‚å…ƒæ°—ã«ãªã‚‹ã€‚'
  };
  const altExample = { // ãƒ’ãƒ³ãƒˆã¨ã—ã¦å‡ºã™å€™è£œ
    '1':'I can stay focused in class.',
    '2':'I feel more awake in the morning.',
    '3':'We can get ready more quickly.',
    '4':'I rarely catch colds.',
    '5':'We can look up information in seconds.'
  };

  // ====== Helpers ======
  const $ = s => document.querySelector(s);
  const el = (t,c) => { const e=document.createElement(t); if(c) e.className=c; return e; };
  const ensurePeriod = s => s.trim().replace(/[ã€‚ï¼]$/,'').replace(/\.+$/,'') + '.';
  const cleanEnd = s => (s||'').replace(/[.ã€‚ï¼]\s*$/,'');
  function sampleDistinct(arr, n){ const a=[...arr], out=[]; while(out.length<n && a.length){ out.push(a.splice(Math.floor(Math.random()*a.length),1)[0]); } return out; }

  // ====== State ======
  const state = { step:0, questions:[], score:0 };

  function initQuestions(){
    let picks;
    if(CONFIG.topicMode==='preset'){
      picks = CONFIG.presetTopics.slice(0, CONFIG.questionCount);
      if(picks.length < CONFIG.questionCount){
        const rest = ['A','B','C','D','E'].filter(k=>!picks.includes(k));
        picks = picks.concat(sampleDistinct(rest, CONFIG.questionCount-picks.length));
      }
    } else {
      picks = sampleDistinct(['A','B','C','D','E'], CONFIG.questionCount);
    }
    state.questions = picks.map(k=>({ topic:k, pickedReason:null, pickedExample:null, reasonCorrect:false, exampleCorrect:false, _scored:false }));
    state.step = 0; state.score = 0;
  }

  // ====== Render ======
  function render(){
    const q = state.questions[state.step];
    $('#qnum').textContent = (state.step+1);
    $('#qtotal').textContent = state.questions.length;
    $('#score').textContent = state.score;
    $('#topicText').textContent = topics.find(t=>t.key===q.topic).text;
    updateBar();

    renderReasonUI(q);
    renderExampleUI(q);
    updatePreview();
    updatePills();
    updateStepVisibility();

    $('#result').className = 'muted';
    $('#result').textContent = 'STEP 1 â†’ STEP 2 ã®é †ã«å®Œæˆã•ã›ã‚ˆã†';
    $('#btn-next').disabled = !(q.reasonCorrect && q.exampleCorrect);
  }

  function renderReasonUI(q){
    const wrap = $('#reasonArea'); wrap.innerHTML='';
    reasons.forEach(r=>{
      const chip = el('button','chip'); chip.type='button'; chip.textContent = `${r.key}. ${r.text}`;
      if(q.reasonCorrect){ chip.disabled = true; }
      chip.addEventListener('click', ()=> onPickReason(r.key, chip));
      wrap.appendChild(chip);
    });
    $('#reasonMsg').className = 'muted';
    $('#reasonMsg').textContent = 'ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ';
  }

  function renderExampleUI(q){
    const block = $('#exampleBlock'), wrap = $('#exampleArea'); wrap.innerHTML='';
    if(!q.reasonCorrect){ block.style.display='none'; return; }
    block.style.display='grid';
    examples.forEach(ex=>{
      const chip = el('button','chip'); chip.type='button';
      chip.textContent = ex.text; // iã€œvã¯è¡¨ç¤ºã—ãªã„
      if(q.exampleCorrect) chip.disabled = true;
      chip.addEventListener('click', ()=> onPickExample(ex.key, chip));
      wrap.appendChild(chip);
    });
    $('#exampleMsg').className = 'muted';
    $('#exampleMsg').textContent = 'ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ';
  }

  function updatePreview(){
    const q = state.questions[state.step];
    const t0 = topics.find(x=>x.key===q.topic).text;
    const r0 = q.pickedReason ? reasons.find(x=>x.key===q.pickedReason).text : 'â€”';
    let ex = q.pickedExample ? examples.find(x=>x.key===q.pickedExample).text : 'â€”';
    const s1 = ensurePeriod(`First, ${cleanEnd(t0)} because ${cleanEnd(r0)}`);
    const s2 = ensurePeriod(`For example, ${ex}`);
    $('#preview').innerHTML = `<b>Preview:</b><br>${s1}<br>${s2}`;
  }

  // ====== STEP pills ======
  function updatePills(){
    const q = state.questions[state.step];
    const p1 = $('#pill-step1'), p2 = $('#pill-step2'), p3 = $('#pill-preview');
    p1.className = 'pill ' + (q.reasonCorrect ? 'done' : 'active');
    p2.className = 'pill ' + (q.reasonCorrect ? (q.exampleCorrect ? 'done' : 'active') : '');
    p3.className = 'pill ' + (q.exampleCorrect ? 'active' : '');
  }

  // ====== STEP1 ã‚’éš ã—ã€è¦ç´„ã‚’ STEP2 ã«è¡¨ç¤º ======
  function updateStepVisibility(){
    const q = state.questions[state.step];
    const rb = $('#reasonBlock');
    const sum = $('#reasonSummary');
    if(q.reasonCorrect){
      rb.style.display = 'none';
      $('#reasonPickedText').textContent = reasons.find(x=>x.key===q.pickedReason).text + 
        `ï¼ˆ${reasonMeta[q.pickedReason].tag}ï¼‰`;
      sum.style.display = 'flex';
      $('#exampleBlock').style.display = 'grid';
    }else{
      rb.style.display = 'grid';
      sum.style.display = 'none';
    }
  }

  // ====== Interactions ======
  function flashBad(node){ node.classList.add('bad','flash'); setTimeout(()=>node.classList.remove('flash'), 600); }

  function explainWrongReason(topicKey, chosenReasonKey){
    const correctTags = (correctReasonsByTopic[topicKey]||[]).map(k=>reasonMeta[k].tag).join(' / ');
    return `ãã®ç†ç”±ã ã¨è©±ãŒãšã‚Œã‚‹ã‚ˆã€‚${topicWhy[topicKey]} ã ã‹ã‚‰ã€ãƒã‚¤ãƒ³ãƒˆã¯ ${correctTags}ã€‚ä»Šãˆã‚‰ã‚“ã ã®ã¯ã€Œ${reasonMeta[chosenReasonKey].tag}ã€ã€‚ã‚‚ã†ä¸€åº¦è€ƒãˆã‚ˆã†ã€‚`;
  }

  function explainWrongExample(pickedReasonKey, pickedExampleKey){
    const exBelongsTo = Object.entries(exampleByReason).find(([r,e])=>e===pickedExampleKey)?.[0];
    return `ãã®ä¾‹ã¯ã€Œ${reasonMeta[exBelongsTo].tag}ã€ã®è©±ã€‚ä»Šã®ç†ç”±ã¯ã€Œ${reasonMeta[pickedReasonKey].tag}ã€ã€‚ã¤ãªãŒã£ã¦ã„ãªã„ã­ã€‚ãƒ’ãƒ³ãƒˆï¼šä¾‹ï¼‰${altExample[pickedReasonKey]}`;
  }

  function onPickReason(key, chip){
    const q = state.questions[state.step];
    const ok = (correctReasonsByTopic[q.topic]||[]).includes(key);
    q.pickedReason = key;
    if(ok){
      q.reasonCorrect = true;
      $('#reasonArea').querySelectorAll('.chip').forEach(b=>{ b.disabled = true; });
      chip.classList.add('ok','selected');
      $('#reasonMsg').className = 'result ok';
      $('#reasonMsg').innerHTML = `âœ… æ­£è§£ï¼<span class="hint">ãƒ’ãƒ³ãƒˆï¼š</span>${topicWhy[q.topic]}`;
      renderExampleUI(q);
      updateStepVisibility();
      setTimeout(()=> document.getElementById('exampleBlock').scrollIntoView({behavior:'smooth', block:'center'}), 40);
    } else {
      flashBad(chip);
      $('#reasonMsg').className = 'result bad';
      $('#reasonMsg').textContent = explainWrongReason(q.topic, key);
    }
    updatePreview(); updatePills();
  }

  function onPickExample(key, chip){
    const q = state.questions[state.step];
    const must = exampleByReason[q.pickedReason];
    q.pickedExample = key;
    const ok = (key === must);
    if(ok){
      q.exampleCorrect = true;
      $('#exampleArea').querySelectorAll('.chip').forEach(b=>{ b.disabled = true; });
      chip.classList.add('ok','selected');
      $('#exampleMsg').className = 'result ok';
      $('#exampleMsg').textContent = 'âœ… æ­£è§£ï¼Previewã‚’ãã„ã¦ç¢ºèªã—ã‚ˆã†';
      if(!(q._scored)) { q._scored = true; state.score += 1; }
      $('#btn-next').disabled = false;
      $('#result').className='result ok';
      $('#result').textContent='ğŸ‰ ã‚ˆãã§ãã¾ã—ãŸï¼ã€Œæ¬¡ã¸ã€ã§ç¶šã‘ã‚ˆã†';
    } else {
      flashBad(chip);
      $('#exampleMsg').className = 'result bad';
      $('#exampleMsg').textContent = explainWrongExample(q.pickedReason, key);
    }
    updatePreview(); updatePills();
  }

  function next(){
    if(state.step < state.questions.length-1){ state.step++; render(); }
    else { $('#result').className='result ok'; $('#result').textContent='ğŸ‰ ã™ã¹ã¦çµ‚äº†ï¼ãŠã¤ã‹ã‚Œã•ã¾'; updateBar(true); updatePills(); }
  }

  function randomizeTopic(){
    const q = state.questions[state.step];
    const pool = ['A','B','C','D','E'].filter(k=>k!==q.topic);
    q.topic = pool[Math.floor(Math.random()*pool.length)];
    q.pickedReason=null; q.pickedExample=null; q.reasonCorrect=false; q.exampleCorrect=false; q._scored=false;
    render();
  }

  function updateBar(done=false){ const pct = done ? 100 : (state.step / state.questions.length) * 100; $('#bar').style.width = pct + '%'; }
  function resetAll(){ initQuestions(); render(); updateBar(); }

  // ====== TTSï¼ˆãƒˆã‚°ãƒ«ï¼‰ ======
  const tts = {
    supported: 'speechSynthesis' in window, utter: null,
    get rate(){ return parseFloat($('#rate').value || '1'); },
    speak(text){ if(!this.supported) return; window.speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(text); u.lang='en-US'; u.rate=this.rate; const vs=speechSynthesis.getVoices(); const v=vs.find(v=>/en-|English/.test(v.lang||v.name)); if(v) u.voice=v; this.utter=u; speechSynthesis.speak(u); },
    stop(){ this.supported && speechSynthesis.cancel(); }
  };
  function previewText(){ return $('#preview').innerText.replace(/^Preview:\s*/,'').trim(); }

  // ====== Init ======
  initQuestions(); render();
  $('#btn-next').addEventListener('click', next);
  $('#btn-randTopic').addEventListener('click', randomizeTopic);
  $('#btn-reset').addEventListener('click', resetAll);
  $('#btn-print').addEventListener('click', ()=> window.print());
  $('#btn-copy').addEventListener('click', ()=>{ const t=$('#answers').textContent.trim(); if(!t) return; navigator.clipboard.writeText(t); });

  // TTS toggle
  const ttsBtn = $('#btn-tts');
  if(tts.supported){
    ttsBtn.addEventListener('click', ()=>{
      const speaking = speechSynthesis.speaking;
      if(!speaking){ tts.speak(previewText()); ttsBtn.textContent='â¹ åœæ­¢'; }
      else { tts.stop(); ttsBtn.textContent='ğŸ”Š èª­ã‚€'; }
    });
    $('#rate').addEventListener('input', ()=>{
      if(speechSynthesis.speaking){ tts.speak(previewText()); ttsBtn.textContent='â¹ åœæ­¢'; }
    });
  } else { $('#ttsNote').textContent='ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãŒTTSã«éå¯¾å¿œï¼‰'; ttsBtn.disabled = true; $('#rate').disabled = true; }
</script>
</body>
</html>
